#{extends 'fap/template.html' /}

#{set title:configfap.get('fap.app.name')/}


%{
	showCert = configfap.getBoolean('fap.login.type.cert')
	showUser = configfap.getBoolean('fap.login.type.user')
%}


#{set 'moreScripts'}
	<script language="javascript" src="http://www.gobiernodecanarias.org/platino/servicios/sfst/js/WS_Full.js" type="text/javascript"></script>
	<script language="javascript" src="http://www.gobiernodecanarias.org/platino/servicios/sfst/js/sfest.utils.js" type="text/javascript"></script>
	<script language="javascript" src="http://www.gobiernodecanarias.org/platino/servicios/sfst/js/sfest.base.js" type="text/javascript"></script>
	<script language="javascript" src="@{'/public/javascripts/platino.js'}" type="text/javascript"></script>
	<script language="javascript" src="@{'/public/javascripts/msg.js'}" type="text/javascript"></script>
#{/set}


<div id="instrucciones" class="span8">
	#{fap.grupo titulo:"Instrucciones"}
		<p>
		   En el caso en que no vea su certificado o no pueda acceder a la aplicación, debe seguir los pasos que se indican 
		   en el apartado requisitos técnicos de la sede electrónica de la 
		   <a target="blank_" title="ACIISI" href="https://www2.gobiernodecanarias.org/aciisi/sede/index.php?option=com_content&view=article&id=265:requisitos-tecnicos&catid=36:paginas-estaticas">ACIISI</a>.
		</p>
		<p>
			Si siguiendo los pasos que ahí se indican sigue sin poder acceder, envíe un correo con su incidencia a 
			soporte platino:
			<a title="Soporte Platino" href="mailto:soporte.sede@gobiernodecanarias.org">soporte.sede@gobiernodecanarias.org</a>
		</p>
		<p>	
			 <h5>Adjuntando la siguiente información:</h5>
		</p>
		<ul>
			<li>Sistema Operativo y versión</li>
			<li>Navegador y versión
				<ul>
					<li>En internet explorer ir a menú Ayuda/Acerca de Internet explorer</li>
				</ul>
			</li>	
			<li>Entidad emisora del certificado utilizado
				<ul>
					<li>En internet explorer ir a herramientas/contenido/certificado/columna emitido por</li>
				</ul>
			</li>					
			<li>Versión de la máquina virtual de java (JRE) utilizada
				<ul>
					<li>En su equipo ir a Configuración/Panel de control/Pulsar sobre el icono de Java/ Acerca de... </li>
				</ul>	
			</li>
		</ul>
	#{/fap.grupo}
	
	#{fap.grupo titulo:"Ayuda"}
		<div style="text-align: center">
			<a class="btn" href="#" style="width:170px">Manual de usuario</a>
			<a href="@{SoporteController.index}" class="btn"  style="width:170px">Preguntas e incidencias</a>
		</div>
	#{/fap.grupo}
</div>

<div class="span8">

#{fap.messages}

#{if showCert}


	#{fap.grupo titulo:"Acceso mediante certificado electrónico"}
		#{form @authenticateCertificate(), id:"cert-form"}
			<input type="hidden" id="token" name="token" value="${token}"/>
			<input type="hidden" id="firma" name="firma" value=""/>
			
			#{bootstrap.select name:'certificado',label:'Certificado', style:'width:100%'/}

			<div class="actions">
				<input type="submit" id="loginsignin" value="&{'fap.login.signin'}" class="btn" />
			</div>
			
		#{/form}
		<div id="cert-msg"></div>
					
	#{/fap.grupo}
	
	<script>
		$(function(){
			var mensajes = new Mensajes("#cert-msg");
			Platino.listarCertificados("#certificado", {mensajes: mensajes});
						
			$('#cert-form').submit(function(e){
				$('#loginsignin').attr("disabled", "true");
				Platino.firmarTexto("#certificado", "#token", "#firma", {mensajes: mensajes});
				mensajes.loading("Comprobando certificado electrónico...");
			});
			
			mensajes.error("#{error 'login-certificado'/}");
		});
	</script>
#{/if}	
	
#{if showUser}
		#{fap.grupo titulo:"Acceso mediante usuario y contraseña"}
			#{form @authenticate(), id:"authen-form"}
				#{bootstrap.text label:play.i18n.Messages.get('fap.login.username'), name:'username', value:flash.username /}
				#{bootstrap.text label:play.i18n.Messages.get('fap.login.password'), name:'password', value:'', type:'password' /}
				#{bootstrap.check label:play.i18n.Messages.get('fap.login.remember'), name:"remember", checked:flash.remember /}
				<div class="actions">
					<input class="btn" type="submit" id="signin" value="&{'fap.login.signin'}" />
				</div>
			#{/form}
			
			<script>
				$(function(){
					$('#authen-form').submit(function(e){
						$('#signin').attr("disabled", "true");
					});
				});
			</script>
		#{/fap.grupo}	
#{/if}
	
#{/fap.messages}

</div>