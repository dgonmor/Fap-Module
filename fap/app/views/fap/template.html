<!DOCTYPE html>

<html>
    <head>
        <title>#{get 'title' /}</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        
        <link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.png'}">
        
        
        #{stylesheet 'jquery-ui.css' /}
        *{
        <link rel="stylesheet" href="@{'/public/javascripts/ext/resources/css/ext-all.css'}" />
        }*
        #{stylesheet 'bootstrap.less' /}
          
        #{get 'moreStyles' /}
        
        #{script src:"jquery/jquery-1.6.1.min.js" /}
        #{script src:"jquery/jquery-ui.1.8.10.min.js" /}
        #{script src:"jquery/jquery.ui.datepicker-es.js" /}
        
        #{script 'ext/ext-all.js' /}
        #{script 'ext/form/SearchFieldFilter.js' /}
		#{script 'bootstrap-dropdown.js' /}

        <link rel="stylesheet" href="@{'/public/javascripts/chosen/chosen.css'}" />
        #{script 'chosen/chosen.jquery.min.js' /}
        
        #{script 'utils.js' /}
        #{script 'listas.js' /}
        #{script 'popup.js' /}
        #{script 'msg.js' /}
		
        #{get 'moreScripts' /}
        
        <script type="text/javascript">
        	if (typeof console == "undefined" || typeof console.log == "undefined") var console = { log: function() {} };
        	if(Ext.isIE){
        		Ext.enableGarbageCollector=false;
        	}
        </script>
               	
    </head>
    <body>
    	<div class="container wrapper">
    		<div class="content">
			
			<div id="header" class="row">
				<div id="logoAciisi" class="span8">
					<a href="@{SolicitudesController.index}" title="&{play.configuration.get('fap.app.name', 'Sin Nombre')}">
						<img src="@{'/public/images/aciisi_gris.gif'}" width="185px" height="75px"/>
					</a>
				</div>				
				<div id="banderaue" class="span8">
					<img src="@{'/public/images/logo_ue.gif'}" width="147px" height="64px"/>
				</div>
	    	</div>

	    	<div class="headeruser row">
				#{if cabeceraUsuario}
					<div class="span16 getCabeceraUsuario">
						#{get 'cabeceraUsuario' /}
					</div>
				#{/if}

				#{if cabeceraUsuario == null}
					%{
						l : {
						def agente = controllers.fap.AgenteController.getAgente();
						def user = null;
						if (agente != null)
							user = agente.name ?: agente.username
					%}	
					<div class="migas">
						#{if user != null}
							#{if solicitud != null}
								#{fap.breadcrumbs solicitud:solicitud.id, title:title, user:user /}
							#{/if}
							#{else}
								#{fap.breadcrumbs title:title, user:user/}
							#{/else}
						#{/if}
						#{else}
							#{fap.breadcrumbs title:title/}
						#{/else}
					</div>
					
					<div class="user">
						#{if agente.roles.size() > 1}
							<ul class="secondary-nav">
							<li class="dropdown" data-dropdown="dropdown" >
						    <a href="#" class="dropdown-toggle"><strong>Axel Hernández Ferrera ${user}</strong> (${models.TableKeyValue.getValue("roles", agente.rolActivo)})</a>
						    <ul class="dropdown-menu">
						      #{if agente.roles.size() > 1}
						      	#{list items:agente.roles, as:'rol'}
						      		<li><a href="@{fap.SecureController.changeRol(request.url, rol)}">${models.TableKeyValue.getValue("roles", rol)}</a></li>
						      	#{/list}
						      <li class="divider"></li>
						      #{/if}
						      <li><a href="@{fap.SecureController.logout()}">&{'fap.header.logout'}</a></li>
						    </ul>
						  </li>
						  </ul>
						#{/if}
						#{else}
							<strong>${user}</strong>
						#{/else}
						
						*{
						#{if agente != null}
							#{if agente.roles.size() > 1}
								#{form @fap.SecureController.changeRol(), id:"changeRolForm"}
								<input type="hidden" name="url" value="${request.url}">
								&{'fap.header.rol'}
									<select id="listaRoles" name="rol" size="1">
										#{list items:agente.roles, as:'entry'}
										%{def selected = entry.equals(agente.rolActivo)? 'selected="selected"' : ''%}
										<option value="${entry}" ${selected}>${models.TableKeyValue.getValue("roles", entry)}</option>
										#{/list}
									</select>
								#{/form}
							#{/if}
							#{a @fap.SecureController.logout()}&{'fap.header.logout'}#{/a}
						#{/if}
						}*
					%{	
						}
					%}	
					</div>
				#{/if}
			</div>
	    				
			#{if menu != null}
				<div class="row">
					<div class="span4">
					#{get 'menu'/}
					</div>
					<div id="content-con-menu" class="span12">
						#{doLayout /}
					</div>
					<div class="clear"></div>
				</div>
			#{/if}
			#{else}
				<div class="row">
					#{doLayout /}
				</div>
			#{/else}
			</div>
			
			<div class="footer">
				©Gobierno de Canarias - <a href="http://www.gobiernodecanarias.org/avisolegal.html">Aviso Legal </a>
			</div>
	    </div>
		

		
		
		<script type="text/javascript">			
        	$(function(){
	          	//Envia el formulario de roles al seleccionar uno
	        	$('#listaRoles').change(function(){
					$('#changeRolForm').submit();        	
	        	});      	
        	});
        </script>
        
    </body>
</html>
